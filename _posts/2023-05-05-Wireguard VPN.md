---
layout: post
title: Wireguard VPN с веб-интерфейсом без мучений
subtitle: Как сделать себе VPN-сервер и сидеть в нормальном интернете
gh-repo: Avonae/avanae.github.io
gh-badge: [follow]
tags: [VPN, Обход блокировок, Свободный интернет, Мануал, Linux]
comments: true
readtime: true
---

Это пост про VPN на своем сервере. Сегодня мы установим Wireguard VPN с удобным веб-интерфейсом, позволяющим создавать конфиги для друзей через браузер. Я сам пользуюсь таким решением и еще 20 моих знакомых.

Основные проблемы с VPN возникают во время поиска достойного провайдера VPS, которому можно заплатить российской картой. Выбирайте какой нравится, мне понравился TimeWeb, в котором всё уже готово. Правда я видел в комментариях его ругали, поэтому как вариант использовать Firstbyte. Он стоит 300р и чуть геморройнее регистрация, но там можно указать левую почту и рандомный телефон, взяв всё из генератора личностей.

## Зачем это все?
Бесплатный сыр бывает только в мышеловке. Если вы используете бесплатный VPN, то спросите себя — на чем он зарабатывает? Бесплатные VPN сервисы <a href="https://privacysavvy.com/vpn/guides/free-vpns-sell-information/" target="_blank">продают ваши данные</a> рекламодателям. Вы вообще ничего не знаете о том, что делают с вашим трафиком и никак этим не управляете. В дополнение, правительство стремится заблокировать популярные VPN сервисы. 

Свой VPN сервер гарантирует вам не только стабильный канал, но и уменьшенную вероятность блокировки. Я пишу уменьшенную вероятность, но не гарантированную защиту — так как правительство постоянно создает новые методы противодействию обходу блокировок. Wireguard — довольно популярный протокол и его легко обнаружить. Как защитить свой сервис от блокировки мы рассмотрим в следующих статьях.

Всего настройка состоит из 2 шагов: аренды сервера и создания клиентов для себя и друзей.

# Аренда сервера

Переходим к аренде сервера. Выбирайте любого понравившегося провайдера. Если у вас есть иностранная карта, могу порекомендовать mvps.net, у них есть <a href="https://www.mvps.net/vps-app/wireguard" target="_blank">готовое VPN решение</a>, хотя и с ограниченным в 2ТБ трафиком. Но я пока не смог истратить это количество.
Арендуем сервер у TimeWeb:
1. Заходите на сайт и зарегистрируетесь
2. Выбирайте в меню слева раздел **Облачные серверы > Создать > Маркетплейсы > VPN > Wireguard-GUI**
![Я выбрал Польшу](/assets/img/WGVPN/0.png)
3. Выбирайте регион
![Я выбрал Польшу](/assets/img/WGVPN/01.png)
4. Отключайте бэкап в разделе **Дополнительные услуги**
5. Оплачиваете. Я заплатил за месяц, **	вышло 188 руб** . По умолчанию, карта оплаты привязывается на будущее — ее можно отвязать в разделе финансы.
6. Ждем письма на почту с данными для подключения к VPN.

# Создание клиентов
Установка сервера закончена, осталось подключить клиенты — телефоны и компьютеры. Их может быть сколько угодно, у нас неограниченный трафик. <a href="https://www.wireguard.com/install/" target="_blank">Установите Wireguard</a> на устройства.
1. Перейдите по ссылке в письме
![Письмо от хостера](/assets/img/WGVPN/1.png)
2. Авторизуйтесь по паролю из того же письма
![Окно авторизации](/assets/img/WGVPN/5.png)
3. Нажмите кнопку **New Client** и укажите произвольное название. Я использую систему **Страна-имя-клиент**, чтобы не путаться в людях. Для примера создадим для подруги Алины конфиг для телефона **Pol-Alina-Mobile**.
![Созданный клиент в веб-интерфейсе](/assets/img/WGVPN/6.png)
4. У каждого конфига есть кнопка скачать и QR-код. Нажмите на кнопку QR-кода и он появится на экране.
5. Откройте Wireguard на телефоне и нажмите кнопку плюса
6. Отсканируйте созданный в веб-интерфейсе QR-код и вуаля, всё готово. Наш впн работает. Проверить это можно на любом сервисе вроде 2ip:
![Слева: активация мобильного приложения, справа — скриншот с 2ip.ru](/assets/img/WGVPN/9.png)

Подобным образом надо создать конфиги для всех устройств.

# Заключение
Это раздел для продвинутых. Тут будут необязательные настройки и мои рассуждения.

## Вопросы безопасности
Считается, что иметь сервер с выделенным IP-адресом и авторизацией по паролю небезопасно. Но пароль, который генерирует хостер достаточно хорош. Вы можете убедиться сами — например, для взлома пароля **zYq6FV3j** понадобится <a href="https://www.passwordmonster.com/" target="_blank">тысяча лет</a>. В общем, это можно выкинуть из головы, если не хотите заморачиваться.

Но в идеале всё-таки аутентификацию по паролю отключить и оставить только по ключу. Ключ — по сути своей, это просто длинный пароль, который хранится у нас на компьютере. Для настройки авторизации по ключу:
1. Откройте Powershell и выполните команду ssh-keygen. Нажмите Enter 3 раза
2. Система сохранит файл ключа в папке `C:\Users\Ваше_Имя_пользователя\.ssh/`. Откройте эту папку и найдите в ней файл id_rsa.pub.
3. Откройте файл текстовым редактором и скопируйте содержимое
4. Вернитесь на сайт хостера и выберите свой сервер в разделе Облачные серверы
5. Перейдите в раздел **Доступ**
6. В поле SSH-ключи нажмите кнопку **Изменить** и вставьте скопированный ключ
7. Ключ добавлен. Вернитесь на шаг назад и активируйте созданный ключ. Подробная инструкция про ключи есть на сайте таймвеба
8. Готово, теперь можно авторизоваться на сервере без пароля. Осталось отключить аутентификацию по паролю. Для примера я буду использовать адрес сервера `111.111.111.11`
9. Зайдите на сервер по SSH: `ssh root@111.111.111.111`
10. Откройте файл конфига SSH: nano /etc/ssh/sshd_config
11. Найдите строчку `PasswordAuthentication Yes` и вместо `Yes` напишите `No`. Сохраните изменения, нажав Ctrl+X. На серверах таймвеба есть дополнительный файл с этой директивой, там тоже нужно отключить: `mv /etc/ssh/sshd_config.d/50-cloud-init.conf ~`
12. Перезапустите службу SSH: `systemctl restart ssh`
13. Готово, теперь сервер в безопасности и авторизоваться по паролю не получится. Сервер настроен и готов к работе.
![Авторизоваться по паролю не вышло](/assets/img/WGVPN/7.png)

## Обновления
По умолчанию, автоматические обновления (unattended upgrades) системы уже включены. Проверить их можно командой `systemctl status unattended-upgrades --no-pager -l`

Можно еще создать пользователя чтобы не сидеть под рутом..:)

Если появились вопросы — пишите в комментариях, буду рад помочь. Подписывайтесь на мой <a href="https://t.me/Press_Any" target="_blank">телеграм-канал</a> — в нем я пишу полезные статьи и рассказываю истории из мира IT.